(()=>{"use strict";function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function e(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(t){"Escape"===t.key&&e(document.querySelector(".popup_is-opened"))}function n(t){var o=t.currentTarget;t.target===o&&e(o)}var r="3b3afde6-a24d-4435-b967-1a1522a2423b",c="wff-cohort-3",u=new Promise((function(t,e){fetch("https://nomoreparties.co/v1/".concat(c,"/users/me"),{headers:{authorization:r}}).then((function(e){t(e.json())}))})),i=new Promise((function(t,e){fetch("https://nomoreparties.co/v1/".concat(c,"/cards"),{headers:{authorization:r}}).then((function(e){t(e.json())}))}));function a(t,e,o,n,u,i){var a=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=a.querySelector(".card__image"),p=a.querySelector(".card__title"),d=a.querySelector(".card__delete-button"),f=a.querySelector(".card__like-button"),_=a.querySelector(".card__like-counter"),m=t.owner&&t.owner._id;return document.querySelectorAll(".popup__button"),l.src=t.link,p.textContent=t.name,l.alt=t.name,_.textContent=t.likes.length,t.likes.some((function(t){return t._id===u}))&&s(f),d.addEventListener("click",(function(){e(a,t._id),console.log(t._id)})),f.addEventListener("click",(function(){f.classList.contains("card__like-button_is-active")?(s(f),function(t){return fetch("https://nomoreparties.co/v1/".concat(c,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:r,"Content-Type":"application/json"}}).then((function(t){if(!t.ok)throw new Error("Ошибка: ".concat(t.status));return t.json()})).catch((function(t){throw new Error("Ошибка при удалении лайка: ".concat(t.message))}))}(t._id).then((function(t){_.textContent=t.likes.length})).catch((function(t){console.error("Ошибка при удалении лайка:",t)}))):(s(f),function(t){return fetch("https://nomoreparties.co/v1/".concat(c,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:r,"Content-Type":"application/json"}}).then((function(t){if(!t.ok)throw new Error("Ошибка: ".concat(t.status));return t.json()})).then((function(t){return t})).catch((function(t){throw new Error("Ошибка при лайке карточки: ".concat(t.message))}))}(t._id).then((function(t){_.textContent=t.likes.length})).catch((function(t){console.error("Ошибка при лайке карточки:",t)})))})),l.addEventListener("click",(function(){n(t)})),d.style.display=u===m?"block":"none",a}function l(t,e){(function(t){return fetch("https://nomoreparties.co/v1/".concat(c,"/cards/").concat(t),{method:"DELETE",headers:{authorization:r}}).then((function(t){if(!t.ok)throw new Error("Ошибка: ".concat(t.status));return t.json()}))})(e).then((function(){console.log("ssfs",e),t.remove()})).catch((function(t){console.error("Ошибка при удалении карточки:",t)}))}function s(t){t.classList.toggle("card__like-button_is-active")}function p(t,e){t.forEach((function(t){t.textContent=e,t.disabled="Сохранение..."===e}))}function d(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n),e.classList.add("form__input_type_error"),r.textContent=o,r.classList.add("form__input-error_active")}function f(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o),e.classList.remove("form__input_type_error"),n.classList.remove("form__input-error_visible"),n.textContent=""}function _(t){return"url"!==t.getAttribute("type")&&!/^[a-zA-Zа-яА-Я\s\-]+$/.test(t.value)}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var y,h=document.querySelector(".places__list"),v=document.querySelector(".profile__add-button"),S=document.querySelectorAll(".popup__close"),b=document.querySelectorAll(".popup"),E=document.querySelector(".popup_type_new-card .popup__form"),q=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup__form"),g=(document.querySelectorAll(".popup__form"),k.querySelector(".popup__input")),w=(k.querySelectorAll(".popup__input"),k.querySelector(".popup__input_type_name")),C=k.querySelector(".popup__input_type_description"),L=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),j=document.querySelector(".profile__image"),T=(document.querySelector(".popup_is-opened"),document.querySelector(".popup_type_image")),x=T.querySelector(".popup__image"),z=T.querySelector(".popup__caption"),O=E.querySelector(".popup__input_type_url"),I=E.querySelector(".popup__input_type_card-name"),P=document.querySelector(".popup_type_new-card"),D=document.querySelector(".popup_type_edit"),B=(k.querySelector(".".concat(g.id,"-error")),document.querySelector(".popup-profile-photo")),N=document.querySelector(".edit-icon"),J=document.querySelector(".popup__input_avatar"),M=(document.querySelector(".card__like-counter"),document.querySelectorAll(".popup__button"));function H(e){x.src=e.link,x.alt=e.name,z.textContent=e.name,t(T)}v.addEventListener("click",(function(){t(P)})),q.addEventListener("click",(function(){w.value=L.textContent,C.value=A.textContent,t(D)})),N.addEventListener("click",(function(){t(B)})),S.forEach((function(t){t.addEventListener("click",(function(){return function(t){e(t.closest(".popup"))}(t)}))})),b.forEach((function(t){t.addEventListener("click",n)})),k.addEventListener("submit",(function(t){var o,n;t.preventDefault(),L.textContent=w.value,A.textContent=C.value,p(M,"Сохранение..."),o=w.value,n=C.value,fetch("https://nomoreparties.co/v1/".concat(c,"/users/me"),{method:"PATCH",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({name:o,about:n})}).then((function(t){if(!t.ok)throw new Error("Ошибка: ".concat(t.status));return t.json()})),e(D),setTimeout((function(){p(M,"Сохранить")}),1e3)})),E.addEventListener("submit",(function(t){!function(t){t.preventDefault();var o=I.value,n=O.value;p(M,"Сохранение..."),function(t,e){return fetch("https://nomoreparties.co/v1/".concat(c,"/cards"),{method:"POST",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:e})}).then((function(t){if(!t.ok)throw new Error("Ошибка: ".concat(t.status));return t.json()}))}(o,n).then((function(t){var o=t.owner._id;(function(t,e,o,n,r){var c=a({name:t,link:e,likes:o,userId:n,cardId:r},l,0,H);h.prepend(c)})(t.name,t.link,t.likes,o,t._id),console.log("handlenewplaceform",t._id),E.reset(),e(P),setTimeout((function(){p(M,"Сохранить")}),1e3)})).catch((function(t){console.error("Ошибка при добавлении карточки:",t)}))}(t)})),y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error"},Array.from(document.querySelectorAll(y.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e,o,n){var r=Array.from(t.querySelectorAll(e)),c=t.querySelector(o);r.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,o){"url"===e.getAttribute("type")?e.validity.valid?f(t,e,o):d(t,e,e.dataset.customError||e.validationMessage,o):e.validity.valid?_(e)?d(t,e,e.dataset.customError||"Используйте только латинские и кириллические буквы, знаки дефиса и пробелы.",o):f(t,e,o):d(t,e,e.dataset.customError||e.validationMessage,o)}(t,e,n),function(t,e){var o=t.some((function(t){var e=!t.validity.valid,o=t.dataset.customError&&""!==t.dataset.customError,n=_(t);return e||o||n}));o?e.setAttribute("disabled",!0):e.removeAttribute("disabled")}(r,c)}))}))}(t,y.inputSelector,y.submitButtonSelector,y.inputErrorClass)})),function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);o.forEach((function(o){f(t,o,e.inputErrorClass)})),n.setAttribute("disabled",!0)}(k,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:".popup__input_type_error"}),B.addEventListener("submit",(function(t){t.preventDefault();var o,n=J.value;J.value="",p(M,"Сохранение..."),(o=n,fetch("https://nomoreparties.co/v1/".concat(c,"/users/me/avatar"),{method:"PATCH",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({avatar:o})}).then((function(t){if(!t.ok)throw new Error("Ошибка: ".concat(t.status));return t.json()})).catch((function(t){throw new Error("Ошибка при смене аватара: ".concat(t.message))}))).then((function(t){j.style.backgroundImage="url('".concat(n,"')"),e(B),setTimeout((function(){p(M,"Сохраненить")}),1e3)})).catch((function(t){console.error("Ошибка при смене аватара:",t)}))})),Promise.all([i,u]).then((function(t){var e,o,n,r,c,u,i,s,p,d,f=(d=2,function(t){if(Array.isArray(t))return t}(p=t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,r,c,u,i=[],a=!0,l=!1;try{if(c=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;a=!1}else for(;!(a=(n=c.call(o)).done)&&(i.push(n.value),i.length!==e);a=!0);}catch(t){l=!0,r=t}finally{try{if(!a&&null!=o.return&&(u=o.return(),Object(u)!==u))return}finally{if(l)throw r}}return i}}(p,d)||function(t,e){if(t){if("string"==typeof t)return m(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?m(t,e):void 0}}(p,d)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),_=f[0],y=f[1];e=_,o=h,n=l,r=H,c=y._id,e.forEach((function(t){var e=a(t,n,0,r,c);o.appendChild(e)})),u=y.name,i=y.about,s=y.avatar,L.textContent=u,A.textContent=i,j.style.backgroundImage="url('".concat(s,"')")})).catch((function(t){console.error("Ошибка:",t)}))})();